// Generated by CoffeeScript 1.9.1
var fs;

fs = require('fs');

module.exports = function(directory) {
  var cache;
  cache = null;
  return {
    set: function(data, callback) {
      data = JSON.stringify(data, null, 2);
      return fs.writeFile(directory + "/config.json", data, callback);
    },
    get: function(callback) {
      if (cache) {
        return cache;
      }
      return fs.readFile(directory + "/config.json", 'utf8', (function(_this) {
        return function(err, data) {
          if (err && err.code === 'ENOENT') {
            data = {
              port_inc: 10180,
              repos: {}
            };
            return fs.writeFile(directory + "/config.json", data, function(err) {
              return callback(err, data);
            });
          }
          if (err) {
            return callback(err);
          }
          try {
            data = JSON.parse(data);
          } catch (_error) {
            err = _error;
            return callback(err);
          }
          cache = data;
          return callback(null, data);
        };
      })(this));
    }
  };
};
